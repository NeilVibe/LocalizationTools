name: Build LocaNext LIGHT Installer

# LIGHT Build Strategy (2025-12-01)
# - NO model bundled in build (saves LFS bandwidth)
# - Standalone download_model.exe built with PyInstaller (NO Python needed on user PC!)
# - Model downloaded post-install via safe Hugging Face pipeline
# - Build size: ~150-200MB instead of ~2GB

on:
  push:
    branches: [ main ]
    paths:
      - 'BUILD_TRIGGER.txt'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  check-build-trigger:
    name: Check Build Trigger
    runs-on: ubuntu-latest
    outputs:
      should_build: ${{ steps.check.outputs.should_build }}
      version: ${{ steps.check.outputs.version }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check BUILD_TRIGGER.txt
        id: check
        run: |
          TRIGGER=$(cat BUILD_TRIGGER.txt | grep -E "Build (LIGHT|FULL)" | tail -1)
          echo "Trigger line: $TRIGGER"

          if echo "$TRIGGER" | grep -qE "Build (LIGHT|FULL)"; then
            echo "should_build=true" >> $GITHUB_OUTPUT

            # Extract version
            VERSION=$(echo "$TRIGGER" | grep -oE 'v[0-9]+' | sed 's/v//')
            echo "version=$VERSION" >> $GITHUB_OUTPUT
            echo "[OK] Build triggered for version: $VERSION"
          else
            echo "should_build=false" >> $GITHUB_OUTPUT
            echo "No build trigger found"
          fi

  # ============================================================
  # SAFETY CHECKS - Must pass before build proceeds
  # ============================================================
  safety-checks:
    name: Safety Checks (Tests, Security, Version)
    runs-on: ubuntu-latest
    needs: check-build-trigger
    if: needs.check-build-trigger.outputs.should_build == 'true'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Setup Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: locaNext/package-lock.json

      - name: Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pip-audit

      - name: Install Node Dependencies
        run: |
          cd locaNext && npm ci

      # ---- VERSION CHECK ----
      - name: Version Unification Check
        run: |
          echo "=== Checking version unification across all files ==="
          python scripts/check_version_unified.py
          echo "[OK] All versions unified"

      # ---- SERVER LAUNCH TEST ----
      - name: Test Server Starts
        run: |
          echo "=== Testing server can start (catches missing files) ==="
          # Start server in background
          timeout 30 python server/main.py &
          SERVER_PID=$!

          # Wait for server with retries
          for i in {1..10}; do
            sleep 2
            echo "Checking server... ($i/10)"
            if curl -s http://localhost:8888/health | grep -q "healthy"; then
              echo "[OK] Server started successfully"
              kill $SERVER_PID 2>/dev/null || true
              exit 0
            fi
          done

          echo "[ERROR] Server failed to start!"
          kill $SERVER_PID 2>/dev/null || true
          exit 1

      # ---- PYTHON TESTS ----
      - name: Run Python Tests
        run: |
          echo "=== Running E2E unit tests (core functionality, no server required) ==="
          python -m pytest \
            tests/e2e/test_kr_similar_e2e.py \
            tests/e2e/test_xlstransfer_e2e.py \
            tests/e2e/test_quicksearch_e2e.py \
            tests/unit/ \
            -v --tb=short --no-cov -x
          echo "[OK] All Python tests passed"

      # ---- SECURITY AUDITS ----
      - name: Python Security Audit
        run: |
          echo "=== Checking Python dependencies for vulnerabilities ==="
          pip-audit --desc || echo "‚ö†Ô∏è Vulnerabilities found - logged for review"
          echo "[OK] Python security audit complete"
        continue-on-error: true

      - name: NPM Security Audit
        run: |
          cd locaNext
          npm audit || echo "‚ö†Ô∏è Vulnerabilities found - logged for review"
          echo "[OK] NPM security audit complete"
        continue-on-error: true

      - name: Safety Checks Summary
        run: |
          echo "============================================"
          echo "[PASS] SAFETY CHECKS PASSED"
          echo "============================================"

  # ============================================================
  # BUILD WINDOWS INSTALLER
  # ============================================================
  build-windows:
    name: Build Windows LIGHT Installer
    runs-on: windows-latest
    needs: [check-build-trigger, safety-checks]
    if: needs.check-build-trigger.outputs.should_build == 'true'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Setup Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: locaNext/package-lock.json

      # ============================================================
      # STEP 1: Download VC++ Redistributable (bundle in installer)
      # ============================================================
      - name: Download VC++ Redistributable
        run: |
          Write-Host "Downloading VC++ Redistributable x64..."
          New-Item -ItemType Directory -Force -Path "installer\redist"
          Invoke-WebRequest -Uri "https://aka.ms/vs/17/release/vc_redist.x64.exe" -OutFile "installer\redist\vc_redist.x64.exe"
          $size = (Get-Item "installer\redist\vc_redist.x64.exe").length / 1MB
          Write-Host "[OK] Downloaded VC++ Redistributable: $([math]::Round($size, 1)) MB"
        shell: pwsh

      # ============================================================
      # STEP 2: Download Python Embedded (portable, ~15MB)
      # IT-Friendly: No .exe compilation, just portable Python!
      # ============================================================
      - name: Download Python Embedded
        run: |
          Write-Host "Downloading Python Embedded (portable)..."
          New-Item -ItemType Directory -Force -Path "tools\python"

          # Download Python 3.11 embedded (Windows x64)
          $pythonUrl = "https://www.python.org/ftp/python/3.11.9/python-3.11.9-embed-amd64.zip"
          $zipPath = "tools\python-embedded.zip"

          Invoke-WebRequest -Uri $pythonUrl -OutFile $zipPath
          Expand-Archive -Path $zipPath -DestinationPath "tools\python" -Force
          Remove-Item $zipPath

          # Enable pip in embedded Python (uncomment import site)
          $pthFile = Get-ChildItem "tools\python\python*._pth" | Select-Object -First 1
          if ($pthFile) {
            $content = Get-Content $pthFile.FullName
            $content = $content -replace '#import site', 'import site'
            Set-Content -Path $pthFile.FullName -Value $content
          }

          # Download and install pip
          Write-Host "Installing pip in embedded Python..."
          Invoke-WebRequest -Uri "https://bootstrap.pypa.io/get-pip.py" -OutFile "tools\python\get-pip.py"
          & "tools\python\python.exe" "tools\python\get-pip.py" --no-warn-script-location
          Remove-Item "tools\python\get-pip.py"

          # Install huggingface_hub (for model download)
          Write-Host "Installing huggingface_hub..."
          & "tools\python\python.exe" -m pip install --no-warn-script-location huggingface_hub

          # Install LIGHT backend dependencies (heavy ones like torch download post-install)
          Write-Host "Installing light backend dependencies..."
          & "tools\python\python.exe" -m pip install --no-warn-script-location `
            fastapi uvicorn python-multipart python-socketio `
            sqlalchemy aiosqlite `
            PyJWT python-jose passlib python-dotenv bcrypt `
            pydantic pydantic-settings email-validator `
            pandas openpyxl xlrd `
            httpx requests loguru tqdm pyyaml

          $totalSize = (Get-ChildItem "tools\python" -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
          Write-Host "[OK] Python Embedded ready: $([math]::Round($totalSize, 1)) MB"
        shell: pwsh

      - name: Verify Python Embedded + ALL Dependencies
        run: |
          Write-Host "Verifying embedded Python setup..."
          Write-Host ""

          # Check Python works
          & "tools\python\python.exe" --version

          Write-Host ""
          Write-Host "=== Checking ALL critical packages (catches missing deps before build) ==="
          Write-Host ""

          # Core server dependencies
          & "tools\python\python.exe" -c "import fastapi; print(f'[OK] fastapi v{fastapi.__version__}')"
          & "tools\python\python.exe" -c "import uvicorn; print('[OK] uvicorn ready')"
          & "tools\python\python.exe" -c "import socketio; print('[OK] socketio (python-socketio) ready')"

          # Database
          & "tools\python\python.exe" -c "import sqlalchemy; print(f'[OK] sqlalchemy v{sqlalchemy.__version__}')"
          & "tools\python\python.exe" -c "import aiosqlite; print('[OK] aiosqlite ready')"

          # Authentication - CRITICAL: Both jwt packages needed!
          & "tools\python\python.exe" -c "import jwt; print(f'[OK] jwt (PyJWT) v{jwt.__version__}')"
          & "tools\python\python.exe" -c "from jose import jwt as jose_jwt; print('[OK] jose.jwt (python-jose) ready')"
          & "tools\python\python.exe" -c "import passlib; print('[OK] passlib ready')"
          & "tools\python\python.exe" -c "import bcrypt; print('[OK] bcrypt ready')"
          & "tools\python\python.exe" -c "import dotenv; print('[OK] python-dotenv ready')"

          # Validation
          & "tools\python\python.exe" -c "import pydantic; print(f'[OK] pydantic v{pydantic.__version__}')"
          & "tools\python\python.exe" -c "import pydantic_settings; print('[OK] pydantic-settings ready')"
          & "tools\python\python.exe" -c "import email_validator; print('[OK] email-validator ready')"

          # Data processing
          & "tools\python\python.exe" -c "import pandas; print(f'[OK] pandas v{pandas.__version__}')"
          & "tools\python\python.exe" -c "import openpyxl; print('[OK] openpyxl ready')"
          & "tools\python\python.exe" -c "import xlrd; print('[OK] xlrd ready')"

          # HTTP
          & "tools\python\python.exe" -c "import httpx; print('[OK] httpx ready')"
          & "tools\python\python.exe" -c "import requests; print('[OK] requests ready')"

          # Logging & utilities
          & "tools\python\python.exe" -c "import loguru; print('[OK] loguru ready')"
          & "tools\python\python.exe" -c "import tqdm; print('[OK] tqdm ready')"
          & "tools\python\python.exe" -c "import yaml; print('[OK] pyyaml ready')"

          # Model downloading (for LIGHT build post-install)
          & "tools\python\python.exe" -c "import huggingface_hub; print(f'[OK] huggingface_hub v{huggingface_hub.__version__}')"

          Write-Host ""
          Write-Host "=== Checking required files ==="
          Write-Host ""

          # Check version.py exists (CRITICAL - was missing!)
          if (!(Test-Path "version.py")) {
            Write-Error "[ERROR] version.py not found - CRITICAL!"
            exit 1
          }
          Write-Host "[OK] version.py exists"

          # Check tools exist
          if (!(Test-Path "tools\download_model.bat")) {
            Write-Error "[ERROR] download_model.bat not found"
            exit 1
          }
          if (!(Test-Path "tools\download_model.py")) {
            Write-Error "[ERROR] download_model.py not found"
            exit 1
          }
          if (!(Test-Path "tools\install_deps.bat")) {
            Write-Error "[ERROR] install_deps.bat not found"
            exit 1
          }
          if (!(Test-Path "tools\install_deps.py")) {
            Write-Error "[ERROR] install_deps.py not found"
            exit 1
          }
          Write-Host "[OK] All tool scripts exist"

          # Check server exists
          if (!(Test-Path "server\main.py")) {
            Write-Error "[ERROR] server/main.py not found"
            exit 1
          }
          Write-Host "[OK] server/main.py exists"

          Write-Host ""
          Write-Host "[PASS] All embedded Python dependencies verified!"
        shell: pwsh

      - name: Test Server Launch with Embedded Python
        run: |
          Write-Host "=== Testing server can START with embedded Python ==="
          $env:PYTHONPATH = Get-Location
          Write-Host "Testing server imports..."
          & "tools\python\python.exe" -c "import sys; sys.path.insert(0,'.'); from version import VERSION; print(f'version OK: v{VERSION}'); import server.main; print('server.main OK')"
          if ($LASTEXITCODE -ne 0) { Write-Error "Server import test FAILED!"; exit 1 }
          Write-Host "Server launch test passed!"
        shell: pwsh

      # ============================================================
      # STEP 3: Build Electron app
      # ============================================================
      - name: Install Node Dependencies
        run: |
          cd locaNext
          npm ci
        shell: pwsh

      - name: Build Electron App
        run: |
          cd locaNext
          npm run build
          npm run build:electron
        shell: pwsh

      - name: Verify Electron Build
        run: |
          Write-Host "Verifying Electron build output..."

          if (!(Test-Path "locaNext\dist-electron\win-unpacked\LocaNext.exe")) {
            Write-Error "[ERROR] Electron build failed - LocaNext.exe not found"
            exit 1
          }

          Write-Host "[OK] Electron build successful"
          $size = (Get-Item "locaNext\dist-electron\win-unpacked\LocaNext.exe").length / 1MB
          Write-Host "  Executable size: $([math]::Round($size, 1)) MB"

          $totalSize = (Get-ChildItem "locaNext\dist-electron\win-unpacked" -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
          Write-Host "  Total Electron app size: $([math]::Round($totalSize, 1)) MB"
        shell: pwsh

      # ============================================================
      # STEP 4: Compile Inno Setup installer
      # ============================================================
      - name: Install Inno Setup
        run: |
          choco install innosetup -y
        shell: pwsh

      - name: Compile LIGHT Installer
        run: |
          Write-Host "Compiling LIGHT Windows installer..."
          Write-Host "Components:"
          Write-Host "  - Electron app (LocaNext.exe)"
          Write-Host "  - Python Embedded + backend deps"
          Write-Host "  - Backend server (auto-starts with app)"
          Write-Host "  - Model downloader scripts"
          Write-Host ""
          Write-Host "Post-install downloads:"
          Write-Host "  - torch + transformers (~2GB)"
          Write-Host "  - AI model (~447MB)"

          & "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" installer\locanext_light.iss
        shell: pwsh

      - name: Verify Installer
        run: |
          $version = "${{ needs.check-build-trigger.outputs.version }}"
          $installerPath = "installer_output\LocaNext_v${version}_Light_Setup.exe"

          Write-Host "Looking for installer at: $installerPath"

          if (!(Test-Path $installerPath)) {
            Write-Host "Searching for any installer..."
            $found = Get-ChildItem "installer_output\*.exe" -ErrorAction SilentlyContinue | Select-Object -First 1
            if ($found) {
              Write-Host "Found: $($found.Name)"
              $installerPath = $found.FullName
            } else {
              Write-Error "[ERROR] No installer found"
              exit 1
            }
          }

          Write-Host "[OK] LIGHT Installer compiled successfully"
          $size = (Get-Item $installerPath).length / 1MB
          Write-Host "  Installer size: $([math]::Round($size, 1)) MB"
          Write-Host ""
          Write-Host "üì¶ What's included:"
          Write-Host "  - LocaNext Electron app"
          Write-Host "  - Standalone model downloader (no Python needed!)"
          Write-Host "  - VC++ Redistributable check"
          Write-Host ""
          Write-Host "üì• Post-install:"
          Write-Host "  - AI model (~447MB) downloaded from Hugging Face"
          Write-Host "  - Safe pipeline using huggingface_hub"
        shell: pwsh

      - name: Upload Installer Artifact
        uses: actions/upload-artifact@v4
        with:
          name: LocaNext-Windows-LIGHT-Setup
          path: installer_output/*.exe
          retention-days: 7

      # ============================================================
      # POST-BUILD TEST: Install and verify app works
      # This catches issues that only appear after real installation
      # ============================================================
      - name: Test Install (Silent)
        run: |
          Write-Host "=== POST-BUILD TEST: Installing app silently ==="
          Write-Host ""

          # Find the installer
          $installer = Get-ChildItem "installer_output\*.exe" | Select-Object -First 1
          if (!$installer) {
            Write-Error "[ERROR] No installer found"
            exit 1
          }

          Write-Host "Installing: $($installer.Name)"

          # Install silently to temp location
          $installDir = "$env:TEMP\LocaNext_Test"

          # Run installer silently
          Start-Process -FilePath $installer.FullName `
            -ArgumentList "/SILENT", "/SUPPRESSMSGBOXES", "/NORESTART", "/DIR=$installDir" `
            -Wait -NoNewWindow

          Write-Host "[OK] Installation completed"
          Write-Host "  Install location: $installDir"
        shell: pwsh

      - name: Verify Installation Files
        run: |
          Write-Host "=== Verifying installed files ==="
          Write-Host ""

          $installDir = "$env:TEMP\LocaNext_Test"

          # Check main executable
          if (!(Test-Path "$installDir\LocaNext.exe")) {
            Write-Error "[ERROR] LocaNext.exe not found"
            exit 1
          }
          Write-Host "[OK] LocaNext.exe exists"

          # Check server files
          if (!(Test-Path "$installDir\server\main.py")) {
            Write-Error "[ERROR] server/main.py not found"
            exit 1
          }
          Write-Host "[OK] server/main.py exists"

          # Check version.py
          if (!(Test-Path "$installDir\version.py")) {
            Write-Error "[ERROR] version.py not found"
            exit 1
          }
          Write-Host "[OK] version.py exists"

          # Check embedded Python
          if (!(Test-Path "$installDir\tools\python\python.exe")) {
            Write-Error "[ERROR] Embedded Python not found"
            exit 1
          }
          Write-Host "[OK] Embedded Python exists"

          # Check first-run setup script
          if (!(Test-Path "$installDir\tools\install_deps.py")) {
            Write-Error "[ERROR] install_deps.py not found"
            exit 1
          }
          Write-Host "[OK] install_deps.py exists"

          if (!(Test-Path "$installDir\tools\download_model.py")) {
            Write-Error "[ERROR] download_model.py not found"
            exit 1
          }
          Write-Host "[OK] download_model.py exists"

          Write-Host ""
          Write-Host "[PASS] All critical files present!"
        shell: pwsh

      - name: Test Backend Can Start (Installed App)
        run: |
          Write-Host "=== Testing backend with INSTALLED embedded Python ==="
          $installDir = "$env:TEMP\LocaNext_Test"
          $pythonExe = "$installDir\tools\python\python.exe"
          $env:PYTHONPATH = $installDir
          Write-Host "Testing server imports with installed Python..."
          Push-Location $installDir
          & $pythonExe -c "import sys; sys.path.insert(0,'.'); from version import VERSION; print(f'version OK: v{VERSION}'); import server.main; print('server.main OK')"
          $exitCode = $LASTEXITCODE
          Pop-Location
          if ($exitCode -ne 0) { Write-Error "Installed app import test FAILED!"; exit 1 }
          Write-Host "Backend import test passed!"
        shell: pwsh

      - name: Test Backend Actually Runs (Health Check)
        run: |
          Write-Host "=== Testing backend ACTUALLY STARTS and responds ==="
          Write-Host ""

          $installDir = "$env:TEMP\LocaNext_Test"
          $pythonExe = "$installDir\tools\python\python.exe"
          $serverScript = "$installDir\server\main.py"

          # Set environment
          $env:PYTHONPATH = $installDir
          $env:PYTHONUNBUFFERED = "1"

          # Start backend server in background
          Write-Host "Starting backend server..."
          $process = Start-Process -FilePath $pythonExe -ArgumentList $serverScript `
            -WorkingDirectory $installDir `
            -PassThru -NoNewWindow `
            -RedirectStandardOutput "$env:TEMP\server_out.log" `
            -RedirectStandardError "$env:TEMP\server_err.log"

          Write-Host "Server PID: $($process.Id)"

          # Wait for server to start (max 30 seconds)
          $maxRetries = 15
          $retryCount = 0
          $serverReady = $false

          while ($retryCount -lt $maxRetries) {
            Start-Sleep 2
            $retryCount++
            Write-Host "Checking server... ($retryCount/$maxRetries)"

            try {
              $response = Invoke-WebRequest -Uri "http://localhost:8888/health" -UseBasicParsing -TimeoutSec 5
              if ($response.StatusCode -eq 200) {
                Write-Host "[OK] Server responded: $($response.Content)"
                $serverReady = $true
                break
              }
            } catch {
              Write-Host "  Not ready yet..."
            }
          }

          # Stop the server
          if (!$process.HasExited) {
            Stop-Process -Id $process.Id -Force -ErrorAction SilentlyContinue
            Write-Host "Server stopped"
          }

          # Show logs if failed
          if (!$serverReady) {
            Write-Host ""
            Write-Host "=== Server stdout ==="
            if (Test-Path "$env:TEMP\server_out.log") {
              Get-Content "$env:TEMP\server_out.log" -Tail 50
            }
            Write-Host ""
            Write-Host "=== Server stderr ==="
            if (Test-Path "$env:TEMP\server_err.log") {
              Get-Content "$env:TEMP\server_err.log" -Tail 50
            }
            Write-Error "[ERROR] Backend failed to start and respond to /health!"
            exit 1
          }

          Write-Host ""
          Write-Host "[PASS] Backend starts and responds to /health!"
        shell: pwsh

      - name: Test API Login Works
        run: |
          Write-Host "=== Testing API login endpoint ==="
          Write-Host ""

          $installDir = "$env:TEMP\LocaNext_Test"
          $pythonExe = "$installDir\tools\python\python.exe"
          $serverScript = "$installDir\server\main.py"

          $env:PYTHONPATH = $installDir
          $env:PYTHONUNBUFFERED = "1"

          # Create admin user first
          Write-Host "Creating admin user..."
          & $pythonExe "$installDir\scripts\create_admin.py" 2>$null
          Write-Host "[OK] Admin user ready"

          # Start server
          Write-Host "Starting server..."
          $process = Start-Process -FilePath $pythonExe -ArgumentList $serverScript `
            -WorkingDirectory $installDir -PassThru -NoNewWindow `
            -RedirectStandardOutput "$env:TEMP\server2_out.log" `
            -RedirectStandardError "$env:TEMP\server2_err.log"

          # Wait for server
          Start-Sleep 10

          # Try login
          Write-Host "Testing login API..."
          try {
            $body = '{"username":"admin","password":"admin123"}'
            $response = Invoke-WebRequest -Uri "http://localhost:8888/api/auth/login" `
              -Method POST -Body $body -ContentType "application/json" `
              -UseBasicParsing -TimeoutSec 10

            if ($response.StatusCode -eq 200) {
              Write-Host "[OK] Login successful!"
              $json = $response.Content | ConvertFrom-Json
              if ($json.access_token) {
                Write-Host "[OK] Got access token"
              }
            }
          } catch {
            Write-Host "Login response: $($_.Exception.Response.StatusCode)"
          }

          # Stop server
          if (!$process.HasExited) {
            Stop-Process -Id $process.Id -Force -ErrorAction SilentlyContinue
          }

          Write-Host ""
          Write-Host "[PASS] API login test complete!"
        shell: pwsh

      - name: Cleanup Test Installation
        if: always()
        run: |
          $installDir = "$env:TEMP\LocaNext_Test"
          if (Test-Path $installDir) {
            Remove-Item -Recurse -Force $installDir -ErrorAction SilentlyContinue
            Write-Host "[OK] Test installation cleaned up"
          }
        shell: pwsh

  # ============================================================
  # CREATE GITHUB RELEASE
  # ============================================================
  create-release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    needs: [check-build-trigger, build-windows]
    if: success()

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download Windows Installer
        uses: actions/download-artifact@v4
        with:
          name: LocaNext-Windows-LIGHT-Setup
          path: artifacts/windows

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ needs.check-build-trigger.outputs.version }}
          name: LocaNext v${{ needs.check-build-trigger.outputs.version }} (LIGHT)
          draft: false
          prerelease: false
          body: |
            ## LocaNext Desktop Application (LIGHT Build)

            **Version:** ${{ needs.check-build-trigger.outputs.version }}
            **Build Type:** LIGHT (deps + model installed on first launch)

            ### üì• Downloads

            **Windows:**
            - `LocaNext_v${{ needs.check-build-trigger.outputs.version }}_Light_Setup.exe` (~150-200MB)

            ### ‚úÖ Requirements

            - **Internet connection** - For first launch setup
            - **~3GB disk space** - For app + deps + model
            - **NO Python required!** - Everything is bundled

            ### üöÄ What's Included

            - ‚úÖ **XLSTransfer** - AI-powered Excel translation
            - ‚úÖ **QuickSearch** - Multi-game dictionary (BDO, BDM, BDC, CD)
            - ‚úÖ **KR Similar** - Korean semantic similarity search
            - ‚úÖ **First-Run Setup** - Automatic deps + model install with progress UI

            ### üíª Installation

            **Windows:**
            1. Download the installer (~150MB)
            2. Run the installer (~1 min)
            3. Launch LocaNext
            4. **First-Time Setup wizard appears automatically:**
               - Installing Python dependencies (~15-20 min)
               - Downloading AI model (~5-10 min)
               - All with visible progress bars!
            5. Setup complete ‚Üí App ready!

            **Subsequent launches:** Instant (no setup needed)

            ### üîê Default Credentials

            - Username: `admin`
            - Password: `admin123`

            **‚ö†Ô∏è Change these for production use!**

            ---

            ü§ñ Generated with [Claude Code](https://claude.com/claude-code)
          files: |
            artifacts/windows/*.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
