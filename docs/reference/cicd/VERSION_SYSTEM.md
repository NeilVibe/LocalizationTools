# Version System

**Unified Version Format: YY.MMDD.HHMM**

---

## The Factorization Principle

> **"If you change it in more than one place, it's not factored."**

Before factorization:
```
VERSION = "2512131540"        â† Manual update
SEMANTIC_VERSION = "1.4.0"    â† Manual update (different format!)
package.json: "1.4.0"         â† Manual update
installer.iss: "2512131540"   â† Manual update
```

After factorization:
```
VERSION = "25.1213.1540"      â† AUTO-GENERATED by pipeline
         â†“ (same value everywhere)
    package.json, installer.iss, UI, etc.
```

---

## Unified Format

**Format:** `YY.MMDD.HHMM`

**Example:** `25.1213.1540`

| Part | Value | Meaning |
|------|-------|---------|
| YY | 25 | Year 2025 |
| MMDD | 1213 | December 13 |
| HHMM | 1540 | 15:40 (3:40 PM KST) |

---

## Why This Format?

### 1. Valid Semantic Version

```
25.1213.1540 = X.Y.Z format
     â†‘    â†‘     â†‘
   Major Minor Patch
```

electron-builder, npm, and all package managers accept this.

### 2. Human Readable

```
25.1213.1540
 â†“
"December 13, 2025 at 15:40 KST"
```

No lookup needed to understand when this build was made.

### 3. Auto-Incrementing

```
Build at 15:40 â†’ 25.1213.1540
Build at 16:05 â†’ 25.1213.1605
Build at 09:30 next day â†’ 25.1214.0930
```

Natural version ordering that increases with time.

### 4. Single Variable

```python
# version.py - THE ONLY SOURCE
VERSION = "25.1213.1540"

# Everything else derives from this
SEMANTIC_VERSION = VERSION  # Same thing!
```

---

## Pipeline Executive Power

The CI/CD pipeline **generates the version automatically**:

```bash
# In pipeline (KST timezone)
VERSION=$(TZ='Asia/Seoul' date '+%y.%m%d.%H%M')
# Result: 25.1213.1640 (at build time)
```

### Injection Points

| File | Pattern | Example |
|------|---------|---------|
| `version.py` | `VERSION = "X"` | `VERSION = "25.1213.1640"` |
| `package.json` | `"version": "X"` | `"version": "25.1213.1640"` |

---

## Version Check Categories

### Critical Files (Block Build)

These are injected by pipeline and MUST match:

```
version.py
server/config.py (imports VERSION)
locaNext/package.json
```

### Informational Files (Warn Only)

These are documentation - don't block builds:

```
README.md
CLAUDE.md
Roadmap.md
```

---

## Triggering a Build

You no longer need to specify version in the trigger:

```bash
# Old way (manual version - deprecated)
echo "Build LIGHT v2512131540" >> GITEA_TRIGGER.txt

# Current way (pipeline auto-generates version)
echo "Build" >> GITEA_TRIGGER.txt
# or
echo "Build QA" >> GITEA_TRIGGER.txt
```

The pipeline will generate `25.1213.HHMM` automatically at build time.

**Valid triggers:** `Build`, `Build QA`, `Build QA FULL` (not implemented), `TROUBLESHOOT`

---

## Validation Script

```bash
# Check all versions are unified
python3 scripts/check_version_unified.py
```

Output:
```
CRITICAL FILES (must match - blocks build):
âœ“ version.py
âœ“ server/config.py
âœ“ locaNext/package.json
âœ“ installer/locanext_electron.iss
âœ“ installer/locanext_light.iss

INFORMATIONAL FILES (docs - warn only):
âœ“ README.md
âœ“ CLAUDE.md
âœ“ Roadmap.md

ðŸŽ‰ SUCCESS! All 5 critical files have version: 25.1213.1540
```

---

## Related Documentation

- [../development/FACTORIZATION_PROTOCOL.md](../development/FACTORIZATION_PROTOCOL.md) - Factorization theory
- [PIPELINE_ARCHITECTURE.md](PIPELINE_ARCHITECTURE.md) - How version flows through pipeline

---

*Last updated: 2025-12-13*
