# How to Build

**Complete guide to triggering CI/CD builds for ALL projects**

---

## Quick Reference: All Workflows

| Project | CI Platform | Trigger File | Push To |
|---------|-------------|--------------|---------|
| **LocaNext** | Gitea Actions | `GITEA_TRIGGER.txt` | GitHub + Gitea |
| **LanguageDataExporter** | GitHub Actions | `LANGUAGEDATAEXPORTER_BUILD.txt` | GitHub only |
| **QACompilerNEW** | GitHub Actions | `QACOMPILER_BUILD.txt` | GitHub only |

---

## 1. LocaNext (Gitea Actions)

### Build Modes

| Mode | Trigger | Description |
|------|---------|-------------|
| **Build / Build QA** | `Build` or `Build QA` | ALL 1000+ tests + installer (~150MB) |
| **TROUBLESHOOT** | `TROUBLESHOOT` | Smart checkpoint: resume from last failure |
| **SKIP_LINUX** | `Build SKIP_LINUX` | Skip tests, direct Windows build |

### Trigger Build

```bash
# Standard build (all tests)
echo "Build NNN" >> GITEA_TRIGGER.txt
git add -A && git commit -m "Build NNN: Description"
git push origin main      # GitHub
git push gitea main       # Gitea (REQUIRED - triggers build!)

# Troubleshoot mode
echo "TROUBLESHOOT" >> GITEA_TRIGGER.txt
git add -A && git commit -m "Troubleshoot" && git push origin main && git push gitea main
```

### Check Build Status

```bash
python3 -c "
import sqlite3
c = sqlite3.connect('/home/neil1988/gitea/data/gitea.db').cursor()
c.execute('SELECT id, status, title FROM action_run ORDER BY id DESC LIMIT 5')
STATUS = {0:'UNK', 1:'OK', 2:'FAIL', 3:'CANCEL', 4:'SKIP', 5:'WAIT', 6:'RUN', 7:'BLOCK'}
for r in c.fetchall(): print(f'Run {r[0]}: {STATUS.get(r[1], r[1]):8} - {r[2]}')"
```

### Gitea Management

```bash
./scripts/gitea_control.sh status   # Check status
./scripts/gitea_control.sh start    # Start Gitea + runners
./scripts/gitea_control.sh stop     # Stop (saves ~60% CPU)
```

### Workflow Location
`.gitea/workflows/build.yml`

---

## 2. LanguageDataExporter (GitHub Actions)

### Trigger Build

```bash
echo "Build NNN - Description" >> LANGUAGEDATAEXPORTER_BUILD.txt
git add LANGUAGEDATAEXPORTER_BUILD.txt
git commit -m "Build NNN: Description"
git push origin main      # GitHub only!
```

### Check Build Status

```bash
gh run list --workflow=languagedataexporter-build.yml --limit 5
gh run view --log   # View latest run logs
```

### Build Artifacts

| Artifact | Description |
|----------|-------------|
| `*_Setup.exe` | Installer with drive selection wizard |
| `*_Portable.zip` | Standalone exe (no install) |
| `*_Source.zip` | Python source code |

### Workflow Location
`.github/workflows/languagedataexporter-build.yml`

### Jobs
1. **validate** - Check trigger, generate version
2. **safety-checks** - Syntax, imports, flake8, security
3. **build-release** - PyInstaller + Inno Setup → GitHub Release

---

## 3. QACompilerNEW (GitHub Actions)

### Trigger Build

```bash
echo "Build NNN - Description" >> QACOMPILER_BUILD.txt
git add QACOMPILER_BUILD.txt
git commit -m "Build NNN: Description"
git push origin main      # GitHub only!
```

### Check Build Status

```bash
gh run list --workflow=qacompiler-build.yml --limit 5
```

### Workflow Location
`.github/workflows/qacompiler-build.yml`

---

## Version Format (All Projects)

**Format:** `YY.MMDD.HHMM` (Asia/Seoul timezone)

**Example:** `26.127.1430` = Jan 27, 2026, 2:30 PM KST

- Auto-generated by CI pipeline
- Valid semver (electron-updater compatible)
- Human readable

---

## TROUBLESHOOT Mode (LocaNext)

Smart checkpoint system that persists across CI runs:

```
1. Trigger: TROUBLESHOOT
   ↓
2. No checkpoint? → Run all tests
   Checkpoint exists? → Run that test first
   ↓
3. Test fails? → Save checkpoint, exit
   ↓
4. Fix code, push, trigger TROUBLESHOOT again
   ↓
5. Repeat until all pass
   ↓
6. Final: Build QA for official release
```

**Checkpoint location:** `/home/neil1988/.locanext_checkpoint`

### Checkpoint Commands

```bash
# Check checkpoint
cat ~/.locanext_checkpoint

# Clear checkpoint (restart from beginning)
rm ~/.locanext_checkpoint

# Force Windows build (skip tests)
echo "WINDOWS_BUILD" > ~/.locanext_checkpoint
```

---

## After Build: INSTALL vs UPDATE (LocaNext)

| | UPDATE | INSTALL |
|--|--------|---------|
| **What** | Auto-updater downloads new version | Fresh installation from .exe |
| **When** | App already installed (common!) | First time, clean slate |
| **Time** | 30 sec - 2 min | 2-5 min |
| **How** | Open app → Download → Restart | `./scripts/playground_install.sh` |

### UPDATE (Most Common)
1. Open LocaNext (already installed)
2. App auto-checks on startup
3. Download notification appears
4. Click "Download" → "Install & Restart"

### INSTALL (Fresh)
```bash
./scripts/playground_install.sh --launch --auto-login
```

---

## Build Output Locations

### LocaNext
| File | Location |
|------|----------|
| Installer | `installer_output/LocaNext_v*.exe` |
| Auto-updater | `installer_output/latest.yml` |

### LanguageDataExporter / QACompiler
| File | Location |
|------|----------|
| All artifacts | GitHub Releases page |

---

## Troubleshooting

### Gitea Build Stuck
```bash
# Check runner
cat /tmp/act_runner.log | tail -20

# Restart runner (if needed)
./scripts/gitea_control.sh stop && sleep 3 && ./scripts/gitea_control.sh start
```

### GitHub Actions Failed
```bash
gh run view --log   # View logs
gh run rerun        # Re-run failed
```

### Release Management (LocaNext)
```bash
./scripts/release_manager.sh list      # List releases
./scripts/release_manager.sh cleanup   # Clean old releases
```

---

*Last updated: 2026-01-27*
